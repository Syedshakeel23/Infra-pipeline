- name: Install Netdata
  hosts: backend
  become: yes
  tasks:
    - name: Install required package (Debian-based)
      apt:
        name: curl
        state: present
      when: ansible_os_family == "Debian"

    - name: Install required package (RedHat-based)
      yum:
        name: curl
        state: present
      when: ansible_os_family == "RedHat"

    - name: Install Netdata
      shell: |
        bash <(curl -Ss https://get.netdata.cloud/kickstart.sh) --dont-wait
      args:
        executable: /bin/bash

    - name: Ensure Netdata is running
      service:
        name: netdata
        state: started
        enabled: yes
      ignore_errors: yes
